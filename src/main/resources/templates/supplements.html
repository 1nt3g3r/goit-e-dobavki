<!doctype html>
<html lang="ru">

<head th:replace="fragments :: head"></head>

<body>
<!--Top menu-->
<th:block th:replace="fragments :: top-menu"></th:block>

<div class="container-fluid">

    <form method="get" action="/">
        <div class="row mb-2">
            <div class="col-12 col-md-10">
                <input class="form-control" type="text" name="searchRequest"
                       placeholder="Введите код или название добавки" th:value="${searchRequest}"/>
            </div>
            <div class="col-12 mt-2 col-md-2 mt-md-0">
                <button type="submit" class="btn btn-block btn-info search-button">
                    <span class="fa fa-search"></span> Искать
                </button>
            </div>
        </div>

        <div class="more-params-block">
            <div class="row mb-2">

                <!--Category-->
                <div class="col-12 col-md-4">
                    <div class="form-group">
                        <label for="supplementCategory">Категория</label>
                        <select id="supplementCategory" name="supplementCategory" class="form-control form-control-sm">
                            <option value="">Любая</option>

                            <option th:each="sCategory: ${supplementCategories}"
                                    th:text="${sCategory.description}"
                                    th:value="${sCategory.name()}"
                                    th:selected="${sCategory == supplementCategory}"></option>
                        </select>
                    </div>
                </div>

                <!--Danger-->
                <div class="col-12 mt-2 mt-md-0 col-md-4">
                    <div class="form-group">
                        <label for="supplementDanger">Опасность</label>
                        <select id="supplementDanger" name="supplementDanger" class="form-control form-control-sm">
                            <option value="">Любая</option>

                            <option th:each="sDanger: ${supplementDangers}"
                                    th:text="${sDanger.description}"
                                    th:value="${sDanger.name()}"
                                    th:selected="${sDanger == supplementDanger}"></option>
                        </select>
                    </div>
                </div>

                <!--Origin-->
                <div class="col-12 mt-2 mt-md-0 col-md-4">
                    <div class="form-group">
                        <label for="supplementOrigin">Происхождение</label>
                        <select id="supplementOrigin" name="supplementOrigin" class="form-control form-control-sm">
                            <option value="">Любое</option>

                            <option th:each="sOrigin: ${supplementOrigins}"
                                    th:text="${sOrigin.description}"
                                    th:value="${sOrigin.name()}"
                                    th:selected="${sOrigin == supplementOrigin}"></option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

    </form>
</div>

<div class="container-fluid">
    <!--Service description-->
    <div th:if="${searchRequest == null and supplementDanger == null and supplementOrigin == null and supplementCategory == null}"
         class="card">
        <div class="card-body">
            <p>
                Сервис пищевых добавок позволяет искать пищевые добавки по их коду либо названию. Просто нажмите на
                нужную добавку для получения полной информации о ней. Если не видите нужной добавки - воспользуйтесь
                поиском.
            </p>
        </div>
    </div>

    <div class="card mt-4">
        <h1 class="card-header bg-success" style="font-size: 1.5rem;"
            th:text="${searchRequest == null ? 'Все пищевые добавки' : 'Результаты поиска'}"></h1>

        <div class="card-body">
            <div class="row justify-content-left ">
                <div th:each="supplement:${supplements}">
                    <div class="card mr-sm-2 mt-sm-4 ml-sm-2">
                        <div th:if="${supplement.danger.name() == 'high'} or ${supplement.danger.name() == 'very_high'}">
                            <div class="card-header bg-danger"
                                 th:utext="'<b>' + ${supplement.eCod} + ' - ' + ${supplement.name} + '</b>'"></div>
                        </div>
                        <div th:if="${supplement.danger.name() == 'low' or supplement.danger.name() == 'very_low' or supplement.danger.name() == 'zero'}">
                            <div class="card-header bg-success"
                                 th:utext="'<b>' + ${supplement.eCod} + ' - ' + ${supplement.name} + '</b>'"></div>
                        </div>
                        <div th:if="${supplement.danger.name() == 'middle'}">
                            <div class="card-header bg-warning"
                                 th:utext="'<b>' + ${supplement.eCod} + ' - ' + ${supplement.name} + '</b>'"></div>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <b>Происхождение: </b>
                                        <a th:href="'/?supplementOrigin=' + ${supplement.origin.name()}"
                                           th:text="${supplement.origin.getDescription()}"></a>
                                </li>
                                <li class="list-group-item">
                                    <b>Категория: </b>
                                        <a th:href="'/?supplementCategory=' + ${supplement.category.name()}"
                                           th:text="${supplement.category.getDescription()}"></a>
                                </li>
                                <li class="list-group-item">
                                    <b>Опасность: </b>
                                    <a th:href="'/?supplementDanger=' + ${supplement.danger.name()}"
                                       th:text="${supplement.danger.getDescription()}"></a>
                                </li>
                            </ul>
                            <a th:href="'/get-supplement/'+${supplement.id}"
                               class="btn btn-primary float-right mt-sm-4">Подробнее</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
      $('.search-button').click(function(e) {
          //Окошко Подождите
          bootbox.dialog({
              message: '<div class="text-center"><i class="fa fa-spin fa-spinner"></i> Подождите, ищем добавки...</div>',
              closeButton: false,
              centerVertical: true
          });
      });


    </script>
</body>

</html>